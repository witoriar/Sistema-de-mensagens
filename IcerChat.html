<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Iced chat</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap');

  * {
    box-sizing: border-box;
  }

  body, html {
    margin: 0;
    padding: 0;
    height: 100%;
    font-family: 'Poppins', sans-serif;
    background-color: #121212; 
    color: #eee;
    display: flex;
    flex-direction: row;
    overflow: hidden;
    align-items: center;
    justify-content: center;
  }

  #neve {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none; 
  z-index: 0;
}

  .chat-container {
    flex: 1;
    display: flex;
    flex-direction: column;
    padding: 20px 30px;
    height: 100vh;
  }

  header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  font-weight: 700;
  font-size: 1.8rem;
  margin-bottom: 10px;
  color: #82aaff;
  }

  #usuarios_online {
  background-color: #0000;    
  color: #75b2e4;                 
  padding: 6px 20px;
  border-radius: 15px;          
  font-weight: 700;
  font-size: 1.3rem;
  min-width: 50px;
  text-align: center;
  box-shadow: 0 4px 12px rgba(156, 159, 180, 0.7);
  user-select: none;
  transition: transform 0.2s ease, box-shadow 0.3s ease;
  cursor: default;

  
}

#usuarios_online:hover {
  transform: scale(1.1);
  box-shadow: 0 6px 16px rgba(95, 108, 216, 0.9);
}

  /* Lista de mensagens */
  #lista_mensagens {
    flex-grow: 1;
    background: #1f1f1f;
    border-radius: 12px;
    padding: 15px 20px;
    margin-bottom: 20px;
    overflow-y: auto;
    font-size: 1rem;
    line-height: 1.3;
  }

  #lista_mensagens li {
    background: #2c2c2c;
    padding: 8px 14px;
    border-radius: 8px;
    margin-bottom: 10px;
    user-select: none;
    transition: background-color 0.3s ease;
  }
  #lista_mensagens li:hover {
    background-color: #3a3a3a;
  }

 
  .inputs {
    display: flex;
    gap: 12px;
    margin-bottom: 15px;
  }
  input[type="text"] {
    flex: 1;
    padding: 10px 14px;
    border-radius: 10px;
    border: none;
    background: #2c2c2c;
    color: #eee;
    font-size: 1rem;
    outline: none;
    transition: box-shadow 0.3s ease;
  }

  input[type="text"]:focus {
    box-shadow: 0 0 8px 2px #82aaff;
    background: #3a3a3a;
  }

  /* Bot√£o enviar */
  #btn_enviar {
    padding: 12px 20px;
    background: #82aaff;
    color: #eee;
    font-weight: 700;
    border: none;
    border-radius: 10px;
    cursor: pointer;
    transition: background-color 0.3s ease;
    flex-shrink: 0;
  }

  #btn_enviar:hover {
    background: #5f85d9;
  }


  .botoes-controle {
    margin-top: 10px;
    display: flex;
    gap: 10px;
    justify-content: center;
  }

  .botoes-controle button {
    flex: 1;
    padding: 10px 8px;
    background: #333;
    color: #eee;
    border: none;
    border-radius: 10px;
    cursor: pointer;
    font-weight: 600;
    transition: background-color 0.3s ease;
    user-select: none;
  }

  .botoes-controle button:hover {
    background: #555;
  }


  .side-image {
    width: 280px;
    background: transparent;
    display: fle;
    justify-content: center;
    align-items: flex-end;
    padding-bottom: 20px;
    user-select: none;
  }

  .side-image img {
    max-height: 70vh;
    object-fit: contain;
    pointer-events: none;
  }


  #lista_mensagens::-webkit-scrollbar {
    width: 8px;
  }
  #lista_mensagens::-webkit-scrollbar-track {
    background: #1f1f1f;
  }
  #lista_mensagens::-webkit-scrollbar-thumb {
    background: #82aaff;
    border-radius: 10px;
  }

  @media(max-width: 720px) {
    body, html {
      flex-direction: column;
    }
    .side-image {
      width: 100%;
      max-height: 180px;
      padding: 10px 0 0 0;
      justify-content: center;
    }
    .chat-container {
      height: auto;
      padding: 15px;
    }
  }

  #contador_caracteres {
    display: block;
    margin-top: 4px;
    font-size: 12px;
    color: rgb(112, 113, 212);
  }

</style>
</head>
<body>
  <div class="chat-container">

    <canvas id="neve"></canvas>

    <header>
      <span>‚ùÑÔ∏è Iced Chat ‚ùÑÔ∏è</span>  
      <span id="usuarios_online">0 </span> 
    </header>

    <ul id="lista_mensagens"></ul>

    <div class="inputs">
      <input type="text" id="input_user" placeholder="Seu nome..." autocomplete="off" />
      <input type="text" id="input_mensagem" placeholder="Digite sua mensagem..." autocomplete="off" />
      <small id="contador_caracteres">0 / 100</small>
      <button id="btn_enviar" onclick="enviar_mensagem()">Enviar</button>
    </div>

    <div class="botoes-controle">
      <button onclick="remover_ultima()">‚¨ÖÔ∏è</button>
      <button onclick="apagar_tudo()">üóëÔ∏è</button>
      <button onclick="atualizar_tela()">üîÑ</button>
    </div>
  </div>

  <div class="side-image">
    <img src="https://images-wixmp-ed30a86b8c4ca887773594c2.wixmp.com/f/f42f52f9-bf3b-49f4-9788-4cd9c4f3a166/dgoeq77-f36f45da-4aab-4a8d-93d0-db6d38eff2bf.png/v1/fill/w_1280,h_2015/frieren_sousou_no_frieren_render_png_by_rspixe_dgoeq77-fullview.png?token=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJ1cm46YXBwOjdlMGQxODg5ODIyNjQzNzNhNWYwZDQxNWVhMGQyNmUwIiwiaXNzIjoidXJuOmFwcDo3ZTBkMTg4OTgyMjY0MzczYTVmMGQ0MTVlYTBkMjZlMCIsIm9iaiI6W1t7ImhlaWdodCI6Ijw9MjAxNSIsInBhdGgiOiJcL2ZcL2Y0MmY1MmY5LWJmM2ItNDlmNC05Nzg4LTRjZDljNGYzYTE2NlwvZGdvZXE3Ny1mMzZmNDVkYS00YWFiLTRhOGQtOTNkMC1kYjZkMzhlZmYyYmYucG5nIiwid2lkdGgiOiI8PTEyODAifV1dLCJhdWQiOlsidXJuOnNlcnZpY2U6aW1hZ2Uub3BlcmF0aW9ucyJdfQ.n9Kp2Ymm2-zxEVnHWhm90idKCwaSLQvKbhRNlSrjLfg" />
  </div>

<script>
  const mensagens = [];

  function atualizar_tela() {
    const lista = document.getElementById('lista_mensagens');
    lista.innerHTML = '';
    mensagens.forEach((msg, i) => {
      const li = document.createElement('li');
      li.textContent = `${i + 1}. ${msg}`;
      lista.appendChild(li);
    });
    lista.scrollTop = 0;
  }

  function enviar_mensagem() {
    const inputMsg = document.getElementById('input_mensagem');
    const inputUser = document.getElementById('input_user');
    const texto = inputMsg.value.trim();
    const user = inputUser.value.trim();

    if (texto === '' || user === '') {
      alert('Por favor, preencha seu nome e mensagem.');
      return;
    }

    if (texto.length > 100) {
      alert("A mensagem n√£o pode ultrapassar 100 caracteres.");
      return;
    }

    const usuario_texto = `${user}: ${texto}`;
    mensagens.push(usuario_texto);
    inputMsg.value = '';
    inputUser.value = '';
    atualizar_tela();

    fetch("http://vianetminas.com.br/mensagens/enviar_mensagem.php", {
      method: "POST",
      headers: { "Content-Type": "application/x-www-form-urlencoded" },
      body: "mensagem=" + encodeURIComponent(usuario_texto)
    }).then(() => recarregar());
  }

  function remover_ultima() {
    if (mensagens.length > 0) {
      mensagens.pop();
      atualizar_tela();
    }
  }

  function apagar_tudo() {
    mensagens.length = 0;
    atualizar_tela();
    fetch("http://vianetminas.com.br/mensagens/limpar_mensagens.php");
  }

  function recarregar() {
    fetch("http://vianetminas.com.br/mensagens/listar_mensagens.php")
      .then(res => res.json())
      .then(data => {
        mensagens.length = 0;
        mensagens.push(...data.map(obj => obj.conteudo));
        atualizar_tela();
      })
      .catch(error => {
        console.error('Erro ao carregar mensagens:', error);
      });
  }
  function usuarios_online() {
    fetch("http://vianetminas.com.br/mensagens/usuarios_online.php")
      .then(res => res.json())
      .then(data => {
        document.getElementById('usuarios_online').textContent = data.online;
      })
      .catch(err => console.error('Erro ao obter usu√°rios online:', err));
  }

  window.onload = function() {
    recarregar();
    usuarios_online();
    
    setInterval(() => {
      recarregar();
      usuarios_online();
    }, 3000);
  };
  
  document.getElementById('input_mensagem').addEventListener('keydown', function(event) {
    if (event.key === 'Enter') {
      event.preventDefault(); 
      enviar_mensagem();
    }
  });
  
  document.getElementById('input_mensagem').addEventListener('input', function () {
  const texto = this.value;
  const contador = document.getElementById('contador_caracteres');
  contador.textContent = `${texto.length} / 100`;

  if (texto.length > 100) {
    contador.style.color = 'red';
  } else {
    contador.style.color = 'blue';
  }
});

  const canvas = document.getElementById("neve");
  const ctx = canvas.getContext("2d");
  let largura, altura;

  function redimensionarCanvas() {
    largura = canvas.width = window.innerWidth;
    altura = canvas.height = window.innerHeight;
  }

  window.addEventListener("resize", redimensionarCanvas);
  redimensionarCanvas();

  const flocos = Array.from({ length: 100 }).map(() => ({
    x: Math.random() * largura,
    y: Math.random() * altura,
    r: Math.random() * 3 + 1,
    d: Math.random() * 1 + 0.5
  }));

  function desenharNeve() {
    ctx.clearRect(0, 0, largura, altura);
    ctx.fillStyle = "rgba(255, 255, 255, 0.8)";
    ctx.beginPath();
    for (let i = 0; i < flocos.length; i++) {
      const f = flocos[i];
      ctx.moveTo(f.x, f.y);
      ctx.arc(f.x, f.y, f.r, 0, Math.PI * 2, true);
    }
    ctx.fill();
    atualizar();
  }

  let √¢ngulo = 0;

  function atualizar() {
    √¢ngulo += 0.1;
    for (let i = 0; i < flocos.length; i++) {
      const f = flocos[i];
      f.y += Math.cos(f.d) + f.r / 2;
      f.x += Math.sin(√¢ngulo) * 0.1;

      if (f.y > altura) {
        f.y = 0;
        f.x = Math.random() * largura;
      }
    }
  }

  function animar() {
    desenharNeve();
    requestAnimationFrame(animar);
  }

  animar();

</script>
</body>
</html>
